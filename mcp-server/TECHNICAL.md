# MDAI MCP Server æŠ€è¡“è©³ç´°

çµ±åˆè¨­è¨ˆæ›¸ã‚·ã‚¹ãƒ†ãƒ ç”¨MCPã‚µãƒ¼ãƒãƒ¼ã®æŠ€è¡“çš„è©³ç´°ãƒ»é–‹ç™ºæƒ…å ±ã€‚

## ğŸ”§ åˆ©ç”¨å¯èƒ½ãªMCPãƒ„ãƒ¼ãƒ«

### `generate_data_model`
**èª¬æ˜**: AIçµŒç”±ã§Mermaid ERå›³ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆ

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
```json
{
  "prompt": "ECã‚µã‚¤ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã‚’ä½œã£ã¦",
  "project_context": {
    "name": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå",
    "id": "project-id"
  },
  "references": ["å‚ç…§ã™ã‚‹ä»–ã®è¨­è¨ˆæ›¸"]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "mermaidCode": "erDiagram\n  User { ... }",
  "supplement": "## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆæ›¸\n...",
  "metadata": {
    "generated_at": "2025-06-25T17:00:00",
    "mode": "ai_generated",
    "ai_provider": "openai"
  }
}
```

### `ping`
**èª¬æ˜**: ã‚µãƒ¼ãƒãƒ¼ç–é€šç¢ºèª

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "status": "ok",
  "message": "MDAI MCP Server is running!"
}
```

### `get_server_info`
**èª¬æ˜**: ã‚µãƒ¼ãƒãƒ¼æƒ…å ±å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "server_name": "MDAI MCP Server",
  "version": "0.1.0",
  "available_tools": ["generate_data_model", "ping", "get_server_info"]
}
```

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### AIç”Ÿæˆã‚¨ãƒ©ãƒ¼ã®å ´åˆ

**ç—‡çŠ¶**: ã‚¨ãƒ©ãƒ¼ERå›³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
```
erDiagram
    ERROR {
        string message
        datetime occurred_at
    }
```

**è§£æ±ºæ–¹æ³•**:
1. `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã§APIã‚­ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šçŠ¶æ³ã‚’ç¢ºèª
3. APIã‚­ãƒ¼ã®åˆ©ç”¨åˆ¶é™ãƒ»æœ‰åŠ¹æœŸé™ã‚’ç¢ºèª

### ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¨ãƒ©ãƒ¼ã®å ´åˆ

**ãƒãƒ¼ãƒˆç«¶åˆã‚¨ãƒ©ãƒ¼**:
```bash
# ãƒãƒ¼ãƒˆ3001ã‚’ä½¿ç”¨ä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
lsof -i :3001

# ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢
kill -9 <PID>
```

**ä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼**:
```bash
# ä¾å­˜é–¢ä¿‚ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv sync --force
```

### WebUIé€£æºã‚¨ãƒ©ãƒ¼ã®å ´åˆ

**ãƒ—ãƒ­ã‚­ã‚·ã‚¨ãƒ©ãƒ¼**:
- Viteé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆport 5173ï¼‰ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- MCPã‚µãƒ¼ãƒãƒ¼ï¼ˆport 3001ï¼‰ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§ãƒ—ãƒ­ã‚­ã‚·ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

## ğŸ”„ é–‹ç™ºãƒ•ãƒ­ãƒ¼

### 1. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆè‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ï¼‰
```bash
# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã«è‡ªå‹•å†èµ·å‹•ï¼‰
uv run mdai-http-server

# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼š
# ğŸš€ MDAI MCP HTTP Server starting...
# ğŸ”§ Mode: AI Dynamic Generation
# ğŸ“¡ Running HTTP server on port 3001 (Auto-reload enabled)
```

### 2. ã‚³ãƒ¼ãƒ‰ç·¨é›†ãƒ»ãƒ†ã‚¹ãƒˆ
```bash
# ã‚³ãƒ¼ãƒ‰ä¿®æ­£ï¼ˆä¿å­˜æ™‚ã«è‡ªå‹•å†èµ·å‹•ï¼‰
vim src/mdai_mcp_server/ai_service.py

# WebUIã§å³åº§ã«ãƒ†ã‚¹ãƒˆå¯èƒ½
# æ‰‹å‹•å†èµ·å‹•ã¯ä¸è¦
```

### 3. ç›´æ¥APIãƒ†ã‚¹ãƒˆ
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆ
curl -X POST http://localhost:3001/ \
  -H "Content-Type: application/json" \
  -d '{
    "method": "generate_data_model",
    "params": {
      "prompt": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«",
      "project_context": {"name": "ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ"}
    },
    "id": "test_generate"
  }'
```

### 4. æ‰‹å‹•å†èµ·å‹•ï¼ˆå¿…è¦ãªå ´åˆã®ã¿ï¼‰
```bash
# è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ãŒåŠ¹ã‹ãªã„å ´åˆã®ã¿
pkill -f mdai-http-server
uv run mdai-http-server
```

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
mcp-server/
â”œâ”€â”€ src/mdai_mcp_server/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ server.py              # æ¨™æº–MCPã‚µãƒ¼ãƒãƒ¼
â”‚   â”œâ”€â”€ http_server.py         # HTTP APIã‚µãƒ¼ãƒãƒ¼
â”‚   â”œâ”€â”€ start_http.py          # HTTPã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆè‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œï¼‰
â”‚   â”œâ”€â”€ ai_service.py          # AIçµ±åˆã‚µãƒ¼ãƒ“ã‚¹
â”‚   â””â”€â”€ tools/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ model_generator.py # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ç”Ÿæˆãƒ„ãƒ¼ãƒ«
â”œâ”€â”€ tests/
â”œâ”€â”€ .env.example               # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ .env                       # ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆä½œæˆå¿…è¦ï¼‰
â”œâ”€â”€ pyproject.toml             # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”œâ”€â”€ README.md                  # æ¦‚è¦ãƒ»ä½¿ã„æ–¹
â””â”€â”€ TECHNICAL.md               # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæŠ€è¡“è©³ç´°ï¼‰
```

## ğŸ” ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°

### MCP Transportå±¤
- **stdio transport**: Claude Desktopç­‰ã®æ¨™æº–MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨
- **HTTP transport**: WebUIçµ±åˆç”¨ï¼ˆJSON-RPC 2.0 over HTTPï¼‰

### AIçµ±åˆå±¤
- **å„ªå…ˆåº¦**: Bedrockï¼ˆè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰â†’ OpenAI
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: AIå¤±æ•—æ™‚ã®å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **å“è³ªä¿è¨¼**: Mermaidæ§‹æ–‡ãƒã‚§ãƒƒã‚¯ãƒ»è‡ªå‹•ä¿®æ­£

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
- **ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ç‰¹åŒ–**: ERå›³ç”Ÿæˆã«æœ€é©åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- **æ–‡æ³•ã‚¨ãƒ©ãƒ¼é˜²æ­¢**: ãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆé™¤å»ãƒ»PK/FKä¿®æ­£
- **æ§‹é€ åŒ–å‡ºåŠ›**: JSONå½¢å¼ã§ã®ç¢ºå®Ÿãªãƒ¬ã‚¹ãƒãƒ³ã‚¹

## ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°

### ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«
```python
# ai_service.py ã§è©³ç´°ãƒ­ã‚°
print(f"ğŸ”µ OpenAI APIå‘¼ã³å‡ºã—é–‹å§‹...")
print(f"âœ… OpenAI APIæˆåŠŸ: {len(response)}æ–‡å­—")
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```python
# ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
try:
    ai_response = await self._generate_with_ai(prompt)
except Exception as e:
    return await self._generate_fallback_data(prompt)
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### AIç”Ÿæˆæ™‚é–“
- **å¹³å‡**: 3-5ç§’ï¼ˆOpenAI GPT-4.1ï¼‰
- **æœ€å¤§**: 10ç§’ï¼ˆè¤‡é›‘ãªãƒ¢ãƒ‡ãƒ«ï¼‰
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: 30ç§’

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- **ãƒ™ãƒ¼ã‚¹**: ~50MBï¼ˆPython + FastMCPï¼‰
- **AIç”Ÿæˆæ™‚**: +20MBï¼ˆä¸€æ™‚çš„ï¼‰
- **æœ€å¤§**: ~100MB

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### API ã‚­ãƒ¼ç®¡ç†
- **ç’°å¢ƒå¤‰æ•°**: .envãƒ•ã‚¡ã‚¤ãƒ«ã§ã®å®‰å…¨ãªç®¡ç†
- **Gité™¤å¤–**: .gitignoreã§æ©Ÿå¯†æƒ…å ±ã®ä¿è­·
- **æœ€å°æ¨©é™**: AI APIã®èª­ã¿å–ã‚Šå°‚ç”¨ã‚¢ã‚¯ã‚»ã‚¹

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
- **CORS**: WebUIï¼ˆlocalhost:5173ï¼‰ã®ã¿è¨±å¯
- **HTTP**: localhost bindingã«ã‚ˆã‚‹å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™

## ğŸ“– é–¢é€£æŠ€è¡“

### ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **FastMCP**: MCP ãƒ—ãƒ­ãƒˆã‚³ãƒ«å®Ÿè£…
- **FastAPI**: HTTP API ã‚µãƒ¼ãƒãƒ¼
- **OpenAI**: AIç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹
- **boto3**: AWS Bedrocké€£æº
- **uvicorn**: ASGI ã‚µãƒ¼ãƒãƒ¼

### MCPæ¨™æº–æº–æ‹ 
- **JSON-RPC 2.0**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ­ãƒˆã‚³ãƒ«
- **åˆæœŸåŒ–ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯**: capabilitiesäº¤æ›
- **Toolså®Ÿè£…**: generate_data_model, ping, get_server_info
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ¨™æº–ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å¯¾å¿œ

## ğŸ†˜ ãƒ‡ãƒãƒƒã‚°æƒ…å ±

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã®è¨ºæ–­æƒ…å ±ï¼š

```bash
# ç’°å¢ƒæƒ…å ±
uv --version
python --version
cat .env  # APIã‚­ãƒ¼ã¯é™¤ã„ã¦

# ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°
uv run mdai-http-server 2>&1 | tee server.log

# ä¾å­˜é–¢ä¿‚ç¢ºèª
uv tree

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¢ºèª
curl http://localhost:3001/health
```