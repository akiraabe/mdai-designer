# MermaidEditor UI/UXæ”¹å–„ã¨ã‚¨ãƒ©ãƒ¼å‡¦ç†æœ€é©åŒ–ï¼ˆ2025å¹´1æœˆå®Ÿè£…ï¼‰ ğŸ¨

## å®Ÿè£…æ¦‚è¦
MermaidEditorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åŒ…æ‹¬çš„UI/UXæ”¹å–„ã¨Mermaidãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é ‘å›ºãªã‚¨ãƒ©ãƒ¼é€šçŸ¥å•é¡Œã®æ ¹æœ¬è§£æ±ºã‚’å®Ÿè£…ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šã¨è¦–è¦šçš„å¿«é©æ€§ã‚’è¿½æ±‚ã—ãŸé«˜å“è³ªãªERå›³ç·¨é›†ç’°å¢ƒã‚’å®Ÿç¾ã€‚

## å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### 1. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã®è‰²èª¿æœ€é©åŒ– ğŸ¨
**å•é¡Œ**: MermaidãŒç”Ÿæˆã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œã®é’è‰²ãŒå¼·ã™ãã¦ç›®éšœã‚Š
**è§£æ±ºç­–**: åŒ…æ‹¬çš„CSS overrideå®Ÿè£…
```css
/* å®Œå…¨ãªé’è‰²æ’é™¤ */
.mermaid-preview * {
  background-color: white !important;
  background: white !important;
  fill: white !important;
}
.mermaid-preview table td,
.mermaid-preview table th {
  border: 1px solid #e5e7eb !important;
  background-color: white !important;
  color: #374151 !important;
}
.mermaid-preview text {
  fill: #374151 !important;
}
```

### 2. UIç°¡ç´ åŒ–ã¨ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š âœ¨
- **é’æ ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆå®Œå…¨å‰Šé™¤**: ModelsSection.tsxã‹ã‚‰å†—é•·ãªèª¬æ˜æ–‡ã‚’é™¤å»
- **1ãƒœã‚¿ãƒ³3ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ**: å†—é•·ãªã€Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºä¸­/éè¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’å‰Šé™¤ã—ã€ç›´æ„Ÿçš„ãªå¾ªç’°å¼åˆ‡ã‚Šæ›¿ãˆã‚’å®Ÿè£…
  - ğŸ”µ **åˆ†å‰²è¡¨ç¤º** (Split) - ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ + ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
  - ğŸŸ¢ **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã¿** (Eye) - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å…¨å¹…è¡¨ç¤º  
  - âš« **ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®ã¿** (Code) - ã‚³ãƒ¼ãƒ‰ç·¨é›†å°‚ç”¨

### 3. ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½å®Ÿè£… ğŸ“
SpreadsheetEditorã¨åŒæ§˜ã®é«˜åº¦ãªãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½ã‚’è¿½åŠ 
- **ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«**: ä¸‹éƒ¨ã«è¦–è¦šçš„ãª8pxé«˜ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«
- **åˆ¶ç´„ç¯„å›²**: 300px-800pxã§ã®å®‰å…¨ãªé«˜ã•èª¿æ•´
- **è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: ãƒªã‚µã‚¤ã‚ºä¸­ã®ç·‘è‰²ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- **ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†**: mousemove/mouseupé©åˆ‡ãªå‡¦ç†

### 4. èª¤æ“ä½œé˜²æ­¢æ©Ÿèƒ½ ğŸ›¡ï¸
**ã‚µãƒ³ãƒ—ãƒ«æŒ¿å…¥ãƒœã‚¿ãƒ³ã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°å®Ÿè£…**
```typescript
if (value.trim().length > 0) {
  const confirmed = window.confirm(
    'âš ï¸ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ\n\n' +
    'ç¾åœ¨ã®Mermaidã‚³ãƒ¼ãƒ‰ãŒå‰Šé™¤ã•ã‚Œã€ã‚µãƒ³ãƒ—ãƒ«ã®ERå›³ã«ç½®ãæ›ã‚ã‚Šã¾ã™ã€‚\n' +
    'ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚'
  );
  if (!confirmed) return;
}
```
- **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ä¿è­·**: ç©ºã§ãªã„å ´åˆã®ã¿ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
- **æ˜ç¢ºãªè­¦å‘Š**: å–ã‚Šè¿”ã—ã®ã¤ã‹ãªã„æ“ä½œã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¤º

### 5. è£œè¶³èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ”¹å–„ ğŸ“
ç©ºã®è£œè¶³èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã®ã€Œç‰¹ã«ãªã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º
```typescript
const displayValue = supplementMarkdown.trim() || 'ç‰¹ã«ãªã—';
```
- **ä¸€è²«æ€§ã®ã‚ã‚‹UX**: ç©ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚‚é©åˆ‡ãªè¡¨ç¤º
- **ç·¨é›†æ™‚ã®è‡ªç„¶ãªå‹•ä½œ**: ã€Œç‰¹ã«ãªã—ã€ç·¨é›†æ™‚ã®é©åˆ‡ãªã‚¯ãƒªã‚¢å‡¦ç†

## Mermaidã‚¨ãƒ©ãƒ¼é€šçŸ¥ã®å®Œå…¨æ’é™¤ï¼ˆç·Šæ€¥å¯¾ç­–ï¼‰

### å•é¡Œã®æ·±åˆ»æ€§
- ãƒ–ãƒ©ãƒ³ã‚¯ã‚·ãƒ¼ãƒˆã§ã‚‚ç”»é¢å·¦ä¸‹ã«çˆ†å¼¾ã‚¢ã‚¤ã‚³ãƒ³ä»˜ãã‚¨ãƒ©ãƒ¼ãŒé‡è¤‡è¡¨ç¤º
- Mermaidãƒ©ã‚¤ãƒ–ãƒ©ãƒªv11.6.0ã®å†…éƒ¨ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒè¨­å®šã‚’ç„¡è¦–
- é€šå¸¸ã®`logLevel`ã‚„`suppressErrorRendering`ã§ã¯è§£æ±ºä¸å¯

### æ ¹æœ¬çš„è§£æ±ºç­–ï¼ˆ3æ®µéšé˜²å¾¡ï¼‰

#### 1. Mermaidãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¨­å®šæœ€é©åŒ–
```javascript
mermaid.initialize({
  logLevel: 5,                    // æœ€é«˜ãƒ¬ãƒ™ãƒ«ã§ã‚¨ãƒ©ãƒ¼æŠ‘åˆ¶
  suppressErrorRendering: true,   // DOMæŒ¿å…¥ç„¡åŠ¹åŒ–
  secure: ['secure', 'securityLevel', 'startOnLoad', 'maxTextSize']
});
```

#### 2. ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç„¡åŠ›åŒ–
```javascript
// console.errorã®é¸æŠçš„ç„¡åŠ¹åŒ–
const originalConsoleError = console.error;
console.error = (...args: any[]) => {
  const message = args.join(' ');
  if (message.includes('mermaid') || message.includes('Syntax error') || message.includes('diagram')) {
    return; // Mermaidé–¢é€£ã‚¨ãƒ©ãƒ¼ã®ã¿æŠ‘åˆ¶
  }
  originalConsoleError.apply(console, args);
};

// Mermaidã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ç©ºé–¢æ•°ã§ä¸Šæ›¸ã
(window as any).mermaid.parseError = () => {};
```

#### 3. DOMè¦ç´ ã®ç‰©ç†çš„å‰Šé™¤
```javascript
// å®šæœŸçš„ãªã‚¨ãƒ©ãƒ¼è¦ç´ å‰Šé™¤
setInterval(() => {
  const errorElements = document.querySelectorAll('[id*="dmermaid"], [class*="error"], [id*="error"]');
  errorElements.forEach(el => {
    if (el.textContent && (el.textContent.includes('Syntax error') || el.textContent.includes('mermaid'))) {
      el.remove();
    }
  });
}, 1000);
```

## æŠ€è¡“çš„é©æ–°ç‚¹

### çŠ¶æ…‹ç®¡ç†ã®çµ±åˆ
- **è¤‡æ•°ã‚¹ãƒ†ãƒ¼ãƒˆçµ±åˆ**: `showPreview` + `viewMode` â†’ å˜ä¸€ã® `displayMode`
- **ãƒªã‚µã‚¤ã‚ºçŠ¶æ…‹ç®¡ç†**: `height`, `isResizing` ã‚¹ãƒ†ãƒ¼ãƒˆã¨ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆåˆ¶å¾¡
- **ä¾å­˜é…åˆ—æœ€é©åŒ–**: useCallbackã®é©åˆ‡ãªä¾å­˜é–¢ä¿‚è¨­å®š

### ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®å¤šå±¤é˜²å¾¡
- **è¨­å®šãƒ¬ãƒ™ãƒ«**: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¨­å®šã§ã®åŸºæœ¬æŠ‘åˆ¶
- **é–¢æ•°ãƒ¬ãƒ™ãƒ«**: JavaScriptã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®é¸æŠçš„ç„¡åŠ¹åŒ–
- **DOM ãƒ¬ãƒ™ãƒ«**: ç‰©ç†çš„ãªè¦ç´ å‰Šé™¤ã«ã‚ˆã‚‹æœ€çµ‚é˜²å¾¡

### ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£è¨­è¨ˆ
- **ç›´æ„Ÿçš„æ“ä½œ**: 1ã‚¯ãƒªãƒƒã‚¯ã§ã®ãƒ¢ãƒ¼ãƒ‰å¾ªç’°åˆ‡ã‚Šæ›¿ãˆ
- **è¦–è¦šçš„ä¸€è²«æ€§**: ã‚¢ã‚¤ã‚³ãƒ³ãƒ»è‰²ãƒ»ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®çµ±ä¸€æ„Ÿ
- **å®‰å…¨æ€§é‡è¦–**: èª¤æ“ä½œé˜²æ­¢ã¨ãƒ‡ãƒ¼ã‚¿ä¿è­·ã®å¾¹åº•

## å®Ÿè£…ã®ä¾¡å€¤

### é–‹ç™ºè€…ä½“é¨“ã®åŠ‡çš„å‘ä¸Š
- **è¦–è¦šçš„å¿«é©æ€§**: é•·æ™‚é–“ä½œæ¥­ã§ã‚‚ç›®ãŒç–²ã‚Œãªã„è‰²èª¿
- **åŠ¹ç‡æ€§**: 1ãƒœã‚¿ãƒ³ã§å…¨ãƒ¢ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹
- **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§**: ä½œæ¥­ã‚¹ã‚¿ã‚¤ãƒ«ã«åˆã‚ã›ãŸé«˜ã•èª¿æ•´
- **å®‰å¿ƒæ„Ÿ**: èª¤æ“ä½œãƒªã‚¹ã‚¯ã®å®Œå…¨æ’é™¤

### æŠ€è¡“çš„å®‰å®šæ€§
- **ã‚¨ãƒ©ãƒ¼æŠ‘åˆ¶**: Mermaidãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å•é¡Œã‚’å®Œå…¨å…‹æœ
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: ä¸è¦ãªã‚¨ãƒ©ãƒ¼è¦ç´ ã®å®šæœŸå‰Šé™¤
- **ä¿å®ˆæ€§**: æ˜ç¢ºãªè²¬ä»»åˆ†é›¢ã«ã‚ˆã‚‹ç®¡ç†å®¹æ˜“æ€§

### ä¼æ¥­åˆ©ç”¨é©åˆæ€§
- **ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å¤–è¦³**: æ´—ç·´ã•ã‚ŒãŸè¦–è¦šãƒ‡ã‚¶ã‚¤ãƒ³
- **å®‰å…¨æ€§**: ãƒ‡ãƒ¼ã‚¿æ¶ˆå¤±é˜²æ­¢ã®å¤šé‡ä¿è­·
- **ä¸€è²«æ€§**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§ã®çµ±ä¸€ã•ã‚ŒãŸUX

## ä¸»è¦æŠ€è¡“ä»•æ§˜

### ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½
```typescript
const [height, setHeight] = useState(500);
const [isResizing, setIsResizing] = useState(false);

const handleMouseMove = useCallback((e: MouseEvent) => {
  if (!isResizing || !containerRef.current) return;
  const rect = containerRef.current.getBoundingClientRect();
  const newHeight = e.clientY - rect.top - 48;
  const constrainedHeight = Math.max(300, Math.min(800, newHeight));
  setHeight(constrainedHeight);
}, [isResizing]);
```

### 3ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯
```typescript
const [displayMode, setDisplayMode] = useState<'split' | 'preview-only' | 'editor-only'>('split');

onClick={() => {
  setDisplayMode(
    displayMode === 'split' ? 'preview-only' :
    displayMode === 'preview-only' ? 'editor-only' : 'split'
  );
}}
```

### ã‚¨ãƒ©ãƒ¼æŠ‘åˆ¶è¨­å®š
```typescript
// å¼·åˆ¶çš„ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ç„¡åŠ¹åŒ–
try {
  console.error = (...args: any[]) => { /* é¸æŠçš„æŠ‘åˆ¶ */ };
  (window as any).mermaid.parseError = () => {};
  setInterval(removeErrorElements, 1000);
} catch (e) {
  console.warn('ã‚¨ãƒ©ãƒ¼æŠ‘åˆ¶å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸãŒã€ã‚¢ãƒ—ãƒªã¯ç¶™ç¶šã—ã¾ã™:', e);
}
```

## ä»Šå¾Œã®ç™ºå±•å¯èƒ½æ€§
- **é«˜åº¦ãªERå›³æ©Ÿèƒ½**: é–¢ä¿‚ç·¨é›†ã€åˆ¶ç´„å®šç¾©ã€æ¤œè¨¼æ©Ÿèƒ½
- **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¼·åŒ–**: PDFã€PNGã€SVGå½¢å¼ã§ã®å‡ºåŠ›
- **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½**: æ¥­ç•Œæ¨™æº–ãƒ¢ãƒ‡ãƒ«ã®è‡ªå‹•ç”Ÿæˆ
- **å”æ¥­æ©Ÿèƒ½**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…±åŒç·¨é›†ã¨ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½